<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>小白科普：分布式和集群 | Life Designer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="小白科普：分布式和集群 | 来自：码农翻身（微信号：coderising） 1 分布式小明的公司有3个系统： 系统 A、系统 B 和系统 C，这三个系统所做的业务不同，被部署在3个独立的机器上运行， 他们之间互相调用（当然是跨域网络的）， 通力合作完成公司的业务流程。">
<meta name="keywords" content="分布式,集群">
<meta property="og:type" content="article">
<meta property="og:title" content="小白科普：分布式和集群">
<meta property="og:url" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/index.html">
<meta property="og:site_name" content="Life Designer">
<meta property="og:description" content="小白科普：分布式和集群 | 来自：码农翻身（微信号：coderising） 1 分布式小明的公司有3个系统： 系统 A、系统 B 和系统 C，这三个系统所做的业务不同，被部署在3个独立的机器上运行， 他们之间互相调用（当然是跨域网络的）， 通力合作完成公司的业务流程。">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/pic1.jpg">
<meta property="og:image" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/pic2.jpg">
<meta property="og:image" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/pic3.jpg">
<meta property="og:image" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/pic4.jpg">
<meta property="og:image" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/pic5.jpg">
<meta property="og:updated_time" content="2017-12-13T03:28:54.991Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小白科普：分布式和集群">
<meta name="twitter:description" content="小白科普：分布式和集群 | 来自：码农翻身（微信号：coderising） 1 分布式小明的公司有3个系统： 系统 A、系统 B 和系统 C，这三个系统所做的业务不同，被部署在3个独立的机器上运行， 他们之间互相调用（当然是跨域网络的）， 通力合作完成公司的业务流程。">
<meta name="twitter:image" content="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/pic1.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Life Designer" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yespon.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/categories">Category</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Life Designer</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Life Designer, design by oneself!</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-小白科普：分布式和集群" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/27/小白科普：分布式和集群/" class="article-date">
  <time datetime="2017-11-27T04:04:16.841Z" itemprop="datePublished">2017-11-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/架构-设计/">架构&设计</a>►<a class="article-category-link" href="/categories/架构-设计/经典文摘/">经典文摘</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      小白科普：分布式和集群
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="小白科普：分布式和集群"><a href="#小白科普：分布式和集群" class="headerlink" title="小白科普：分布式和集群"></a>小白科普：分布式和集群</h1><p> | 来自：码农翻身（微信号：coderising）</p>
<h2 id="1-分布式"><a href="#1-分布式" class="headerlink" title="1 分布式"></a>1 分布式</h2><p>小明的公司有3个系统： 系统 A、系统 B 和系统 C，这三个系统所做的业务不同，被部署在3个独立的机器上运行， 他们之间互相调用（当然是跨域网络的）， 通力合作完成公司的业务流程。</p>
<p><img src="/2017/11/27/小白科普：分布式和集群/pic1.jpg" alt="image"><br><a id="more"></a><br>将不同的业务分布在不同的地方， 这就构成了一个<strong>分布式</strong>的系统，现在问题来了， 系统A是整个分布式系统的“脸面”， 用户直接访问，用户量访问大的时候要么是速度巨慢，要么直接挂掉， 怎么办？</p>
<p>由于系统A只有一份， 所以会引起<strong>单点失败</strong>。</p>
<h2 id="2-集群（Cluster）"><a href="#2-集群（Cluster）" class="headerlink" title="2 集群（Cluster）"></a>2 集群（Cluster）</h2><p>小明的公司不差钱，就多买几台机器吧， 小明把系统A一下子部署了好几份（例如下图的3个服务器），<strong>每一份都是系统A的一个实例， 对外提供同样的服务，</strong>这样能睡个安稳觉了，不怕其中一个坏掉了，我还有另外两个呢。</p>
<p>这3个服务器上的系统就组成了一个集群。</p>
<p><img src="/2017/11/27/小白科普：分布式和集群/pic2.jpg" alt="image"></p>
<p>可是对用户来说，一下子出现这么系统A ，每个系统的IP地址都不一样，  到底访问哪一个？</p>
<p>如果所有人都访问服务器1.1 ，那服务器1.1 会被累死， 剩下的三个闲死，成了浪费钱的摆设。</p>
<h2 id="3-负载均衡（Load-Balancer）"><a href="#3-负载均衡（Load-Balancer）" class="headerlink" title="3 负载均衡（Load Balancer）"></a>3 负载均衡（Load Balancer）</h2><p>小明要尽可能的让3个机器上的系统A 工作均衡一些， 比如有3万个请求，那就让3个服务器各处理1万个（当然，这是理想状况）， 这叫<strong>负载均衡</strong>。</p>
<p>很明显，这个负载均衡的工作最好独立出来， 放到独立的服务器上 （例如Ngnix）：</p>
<p><img src="/2017/11/27/小白科普：分布式和集群/pic3.jpg" alt="image"></p>
<p>后来小明发现， 这个<strong>负载均衡</strong>的服务器虽然工作内容很简单，就是拿到请求，分发请求，但是它还是有可能挂掉啊， <strong>单点失败</strong>还是会出现。</p>
<p>没办法，只好把<strong>负载均衡</strong>也搞成一个<strong>集群</strong>， 不过和系统A的集群有两点不同：</p>
<ul>
<li>这个新的集群中虽然有两个机器，但我们可以用某种办法，让这个集群对外只提供一个IP地址， 也就是说<strong>用户看到的好像只有一个机器</strong>。</li>
<li><strong>同一时刻，我们只让一个负载均衡的机器工作， 另外一个原地待命</strong>。 如果工作的那个挂掉了，待命的那个就顶上去。</li>
</ul>
<p><img src="/2017/11/27/小白科普：分布式和集群/pic4.jpg" alt="image"></p>
<h2 id="4-弹性"><a href="#4-弹性" class="headerlink" title="4 弹性"></a>4 弹性</h2><p>如果这3个系统A的实例还是满足不了大量的请求，那就再加服务器！</p>
<p>双11来了，用户量是平时的10倍， 小明向领导申请费用又买了几十台服务器，一下子把系统A部署了几十份。  可是双11过后， 流量一下子降下来了，那几十个服务器用不上了，也变成了摆设！</p>
<p>被领导批评以后，小明决定尝试一下云计算，  在云端可以轻松的创建、删除虚拟的服务器， 那样就可以轻松地随着用户的请求动态的增减服务器了。  双11来了就创建虚拟服务器，等到双11过去了就把不用的关掉， 省得浪费钱。</p>
<p>于是小明的系统具备了一定的弹性。</p>
<h2 id="5-失效转移"><a href="#5-失效转移" class="headerlink" title="5 失效转移"></a>5 失效转移</h2><p>上面的系统看起来很美好，但是做了一个不切实际的假设： 所有的服务都是无状态的。 换句话说，假设用户的两次请求直接是没有关联的。</p>
<p>但是现实是，大部分服务都是有状态的， 例如购物车。</p>
<p>用户访问系统，在服务器1.1上创建了一个购物车，并向其中加入了几个商品， 然后 服务器1.1 挂掉了， 用户的后续访问就找不到服务器1.1了，这时候就要做失效转移，让另外几个服务器去接管、去处理用户的请求。</p>
<p>可是问题来了，在服务器1.2，1.3上有用户的购物车吗？  如果没有， 用户就会抱怨，我刚创建的购物车哪里去了？</p>
<p>还有更严重的，假设用户是在服务器1.1上登录的， 用户登录过的信息保存到了该服务器的 session 中， 现在这个服务器挂掉了， 用户的 session 自然也不见了，当用户被失效转移到其他服务器上的时候，其他服务器发现用户没有登录， 就把用户踢到了登录界面， 让用户再次登录！</p>
<p>状态，状态，状态！用户的登录信息，购物车等都是状态信息，  处理不好状态的问题，集群的威力就大打折扣，无法完成真正的失效转移， 甚至无法使用。</p>
<p>怎么办？</p>
<p>一种办法是把状态信息在集群的各个服务器之间复制，让集群的各个服务器达成一致，  谁来干这个事情？ 只能是像 Websphere, Weblogic 这样的应用服务器了。</p>
<p>还有一种办法， 就是把状态信息集中存储在一个地方， 让集群的各个服务器都能访问到：</p>
<p><img src="/2017/11/27/小白科普：分布式和集群/pic5.jpg" alt="image"></p>
<p>小明听说 Redis 不错， 那就用 Redis 来保存吧 ！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yespon.github.io/2017/11/27/小白科普：分布式和集群/" data-id="cjcc1x2vs001ikowg15dmqelo" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/集群/">集群</a></li></ul>

    </footer>
  </div>
  
    
 <script src="/jquery/jquery.min.js"></script>
  <div id="random_posts">
    <h2>Recommended Posts</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2017/11/27/TensorFlow学习——TensorFlow-Core/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          TensorFlow学习——TensorFlow Core
        
      </div>
    </a>
  
  
    <a href="/2017/11/26/Tensorflow学习笔记/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Tensorflow学习笔记</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
           <div id="gitment_comments"></div>
    
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">Content</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#小白科普：分布式和集群"><span class="toc-number">1.</span> <span class="toc-text">小白科普：分布式和集群</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-分布式"><span class="toc-number">1.1.</span> <span class="toc-text">1 分布式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-集群（Cluster）"><span class="toc-number">1.2.</span> <span class="toc-text">2 集群（Cluster）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-负载均衡（Load-Balancer）"><span class="toc-number">1.3.</span> <span class="toc-text">3 负载均衡（Load Balancer）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-弹性"><span class="toc-number">1.4.</span> <span class="toc-text">4 弹性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-失效转移"><span class="toc-number">1.5.</span> <span class="toc-text">5 失效转移</span></a></li></ol></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
    
  
    <!--微信公众号二维码-->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2018 Yespon&nbsp;|&nbsp;
      Theme by <a href="https://github.com/yespon/hexo-theme-yespon/" target="_blank">Yespon</a>
    </div>
     <div id="footer-right">
      Contact&nbsp;|&nbsp;yespon#qq.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/categories" class="mobile-nav-link">Category</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script> 
  <script>
  var gitment = new Gitment({
    // id: '页面 ID', // 可选。默认为 location.href
    owner: 'yespon',
    repo: 'yespon.github.io',
    oauth: {
    client_id: '4ab181ded22ebacbab72',
    client_secret: 'c3cd3df382f34a5685a1608234223423248250f7',
    }
  })
  gitment.render(document.getElementById("gitment_comments"))
</script>


<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>